<!DOCTYPE html>
<html lang="en" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nanosecond Arbiter AI Arena | Live Trading</title>
    <meta name="description" content="AI-powered trading with ultra-low latency execution">
    <link rel="stylesheet" href="styles.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <!-- Notification Container -->
    <div class="notification-container" id="notification-container"></div>

    <!-- Keyboard Shortcuts Modal -->
    <div class="shortcuts-modal" id="shortcuts-modal">
        <div class="shortcuts-content">
            <div class="shortcuts-header">
                <span class="shortcuts-title">‚å®Ô∏è Keyboard Shortcuts</span>
                <button class="shortcuts-close" onclick="toggleShortcutsModal()">√ó</button>
            </div>
            <div class="shortcut-group">
                <div class="shortcut-group-title">General</div>
                <div class="shortcut-row">
                    <div class="shortcut-keys"><span class="key">?</span></div>
                    <span class="shortcut-description">Toggle this help panel</span>
                </div>
                <div class="shortcut-row">
                    <div class="shortcut-keys"><span class="key">T</span></div>
                    <span class="shortcut-description">Toggle dark/light theme</span>
                </div>
                <div class="shortcut-row">
                    <div class="shortcut-keys"><span class="key">M</span></div>
                    <span class="shortcut-description">Toggle sound alerts</span>
                </div>
                <div class="shortcut-row">
                    <div class="shortcut-keys"><span class="key">Esc</span></div>
                    <span class="shortcut-description">Close modals</span>
                </div>
            </div>
            <div class="shortcut-group">
                <div class="shortcut-group-title">Data</div>
                <div class="shortcut-row">
                    <div class="shortcut-keys"><span class="key">E</span></div>
                    <span class="shortcut-description">Export trades as CSV</span>
                </div>
                <div class="shortcut-row">
                    <div class="shortcut-keys"><span class="key">J</span></div>
                    <span class="shortcut-description">Export trades as JSON</span>
                </div>
                <div class="shortcut-row">
                    <div class="shortcut-keys"><span class="key">R</span></div>
                    <span class="shortcut-description">Refresh data</span>
                </div>
            </div>
            <div class="shortcut-group">
                <div class="shortcut-group-title">Navigation</div>
                <div class="shortcut-row">
                    <div class="shortcut-keys"><span class="key">1</span></div>
                    <span class="shortcut-description">Scroll to Performance</span>
                </div>
                <div class="shortcut-row">
                    <div class="shortcut-keys"><span class="key">2</span></div>
                    <span class="shortcut-description">Scroll to Crypto Section</span>
                </div>
                <div class="shortcut-row">
                    <div class="shortcut-keys"><span class="key">3</span></div>
                    <span class="shortcut-description">Scroll to Advanced Metrics</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <div class="logo">
                <span class="logo-icon">‚ö°</span>
                <span class="logo-text">Nanosecond Arbiter</span>
            </div>
            <span class="badge badge-live">AI Arena</span>
        </div>
        <div class="header-right">
            <div class="engine-status">
                <span class="status-dot"></span>
                <span>Rust SPSC Engine Active</span>
            </div>
            <div class="latency-badge">
                <span class="latency-icon">‚ö°</span>
                <span class="latency-value" id="latency-value">29ns</span>
            </div>
            <button class="sound-toggle" id="sound-toggle" onclick="toggleSound()" title="Toggle Sound (M)">
                üîä
            </button>
            <button class="theme-toggle" id="theme-toggle" onclick="toggleTheme()" title="Toggle Theme (T)">
                üåô
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content" id="main-content">
        <!-- Left Column: Performance & Order Book -->
        <div class="left-column">
            <!-- Performance Chart -->
            <section class="card performance-card">
                <div class="card-header">
                    <h2>üìà Portfolio Performance</h2>
                    <div class="pnl-display">
                        <span class="label">P&L:</span>
                        <span class="pnl-value" id="pnl-value">+$0.00</span>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="performance-chart"></canvas>
                </div>
                <div class="stats-row">
                    <div class="stat">
                        <span class="stat-label">Account Value</span>
                        <span class="stat-value" id="account-value">$10,000.00</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Trades Today</span>
                        <span class="stat-value" id="trades-count">0</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Win Rate</span>
                        <span class="stat-value" id="win-rate">0%</span>
                    </div>
                </div>
            </section>

            <!-- Latency Histogram (NEW!) -->
            <section class="card latency-histogram-card">
                <div class="card-header">
                    <h2>üìä Latency Distribution</h2>
                    <span class="spread-badge" id="latency-samples">1M samples</span>
                </div>
                <div class="histogram-container">
                    <div class="histogram-chart" id="histogram-chart">
                        <!-- Histogram bars will be generated by JS -->
                    </div>
                    <div class="percentile-grid">
                        <div class="percentile-box p50">
                            <span class="percentile-label">P50</span>
                            <span class="percentile-value" id="p50-value">19ns</span>
                        </div>
                        <div class="percentile-box p95">
                            <span class="percentile-label">P95</span>
                            <span class="percentile-value" id="p95-value">25ns</span>
                        </div>
                        <div class="percentile-box p99">
                            <span class="percentile-label">P99</span>
                            <span class="percentile-value" id="p99-value">32ns</span>
                        </div>
                        <div class="percentile-box p999">
                            <span class="percentile-label">P99.9</span>
                            <span class="percentile-value" id="p999-value">45ns</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Order Book -->
            <section class="card orderbook-card">
                <div class="card-header">
                    <h2>üìä Order Book</h2>
                    <span class="spread-badge" id="spread-badge">Spread: -</span>
                </div>
                <div class="orderbook-container">
                    <div class="orderbook-side asks">
                        <div class="orderbook-header">
                            <span>Price</span>
                            <span>Size</span>
                        </div>
                        <div class="orderbook-rows" id="asks-rows">
                            <!-- Asks will be populated here -->
                        </div>
                    </div>
                    <div class="orderbook-side bids">
                        <div class="orderbook-rows" id="bids-rows">
                            <!-- Bids will be populated here -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Active Positions -->
            <section class="card positions-card">
                <div class="card-header">
                    <h2>üìä Active Positions</h2>
                </div>
                <div class="table-container">
                    <div class="table-container positions-grid" id="positions-body">
                        <!-- Vertical Position Cards populated via JS -->
                        <div class="empty-state">No open positions</div>
                    </div>
                </div>
            </section>
        </div>

        <!-- Right Column: AI & Trades -->
        <div class="right-column">
            <!-- AI Model Card with Explainable AI -->
            <section class="card ai-card explainable-ai-card">
                <div class="card-header">
                    <h2>ü§ñ AI Trading Model</h2>
                    <div class="model-badge">
                        <img src="https://www.gstatic.com/lamda/images/gemini_sparkle_v002_d4735304ff6292a690345.svg"
                            alt="Gemini" class="model-icon">
                        <span>Gemini 2.0 Flash</span>
                    </div>
                </div>
                <div class="ai-status">
                    <div class="ai-indicator">
                        <span class="thinking-dot"></span>
                        <span id="ai-status-text">Analyzing market...</span>
                    </div>
                </div>

                <!-- Explainable AI Decision Chain (NEW!) -->
                <div class="ai-decision-chain" id="ai-decision-chain">
                    <div class="decision-step">
                        <span class="step-number">1</span>
                        <span class="step-text">Analyzing 24h price momentum...</span>
                    </div>
                    <div class="decision-step">
                        <span class="step-number">2</span>
                        <span class="step-text">Checking RSI indicators...</span>
                    </div>
                    <div class="decision-step">
                        <span class="step-number">3</span>
                        <span class="step-text">Evaluating order flow imbalance...</span>
                    </div>
                </div>

                <!-- Confidence Gauge (NEW!) -->
                <div class="confidence-gauge">
                    <div class="confidence-label">
                        <span class="confidence-text">AI Confidence</span>
                        <span class="confidence-value" id="confidence-value">78%</span>
                    </div>
                    <div class="confidence-bar">
                        <div class="confidence-fill high" id="confidence-fill" style="width: 78%"></div>
                    </div>
                </div>

                <div class="ai-decision" id="ai-decision">
                    <div class="decision-box neutral">
                        <span class="decision-label">Current Signal</span>
                        <span class="decision-value" id="current-signal">NEUTRAL</span>
                    </div>
                </div>
            </section>

            <!-- Risk Metrics Dashboard (NEW!) -->
            <section class="card risk-card">
                <div class="card-header">
                    <h2>‚ö†Ô∏è Risk Metrics</h2>
                    <button class="export-btn" onclick="exportRiskReport()">
                        üì• Export
                    </button>
                </div>
                <div class="risk-grid">
                    <div class="risk-metric">
                        <div class="risk-metric-header">
                            <span class="risk-metric-name">Sharpe Ratio</span>
                            <span class="risk-metric-icon">üìà</span>
                        </div>
                        <span class="risk-metric-value positive" id="sharpe-ratio">1.85</span>
                        <div class="risk-meter">
                            <div class="risk-meter-fill good" id="sharpe-meter" style="width: 75%"></div>
                        </div>
                    </div>
                    <div class="risk-metric">
                        <div class="risk-metric-header">
                            <span class="risk-metric-name">Max Drawdown</span>
                            <span class="risk-metric-icon">üìâ</span>
                        </div>
                        <span class="risk-metric-value negative" id="max-drawdown">-3.2%</span>
                        <div class="risk-meter">
                            <div class="risk-meter-fill warning" id="drawdown-meter" style="width: 32%"></div>
                        </div>
                    </div>
                    <div class="risk-metric">
                        <div class="risk-metric-header">
                            <span class="risk-metric-name">Win/Loss Ratio</span>
                            <span class="risk-metric-icon">‚öñÔ∏è</span>
                        </div>
                        <span class="risk-metric-value neutral" id="win-loss-ratio">1.42</span>
                        <div class="risk-meter">
                            <div class="risk-meter-fill good" id="winloss-meter" style="width: 65%"></div>
                        </div>
                    </div>
                    <div class="risk-metric">
                        <div class="risk-metric-header">
                            <span class="risk-metric-name">VaR (95%)</span>
                            <span class="risk-metric-icon">üéØ</span>
                        </div>
                        <span class="risk-metric-value neutral" id="var-value">$125.50</span>
                        <div class="risk-meter">
                            <div class="risk-meter-fill warning" id="var-meter" style="width: 45%"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Engine Metrics -->
            <section class="card metrics-card">
                <div class="card-header">
                    <h2>üöÄ Engine Performance</h2>
                </div>
                <div class="metrics-grid">
                    <div class="metric">
                        <span class="metric-value" id="engine-latency">29</span>
                        <span class="metric-unit">ns</span>
                        <span class="metric-label">Execution Latency</span>
                    </div>
                    <div class="metric">
                        <span class="metric-value" id="engine-throughput">33.5M</span>
                        <span class="metric-unit">ops/s</span>
                        <span class="metric-label">Max Throughput</span>
                    </div>
                    <div class="metric">
                        <span class="metric-value" id="orders-processed">0</span>
                        <span class="metric-unit"></span>
                        <span class="metric-label">Orders Processed</span>
                    </div>
                    <div class="metric">
                        <span class="metric-value" id="uptime">0</span>
                        <span class="metric-unit">s</span>
                        <span class="metric-label">Uptime</span>
                    </div>
                </div>
            </section>

            <!-- Trade Feed -->
            <section class="card trades-card">
                <div class="card-header">
                    <h2>üí∞ Recent Trades</h2>
                    <div style="display: flex; gap: 8px;">
                        <button class="export-btn" onclick="exportTradesCSV()" title="Export CSV (E)">
                            üìÑ CSV
                        </button>
                        <button class="export-btn" onclick="exportTradesJSON()" title="Export JSON (J)">
                            üìã JSON
                        </button>
                    </div>
                </div>
                <div class="trades-container" id="trades-container">
                    <div class="trade-placeholder">
                        <span>No trades yet. AI is analyzing...</span>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Advanced Metrics Section (NEW!) -->
    <section class="advanced-section" id="advanced-section">
        <div class="advanced-header">
            <h2>‚öôÔ∏è Advanced Analytics</h2>
            <span class="badge badge-pro">PRO</span>
        </div>
        <div class="advanced-grid">
            <!-- Order Flow Visualization -->
            <div class="card order-flow-card">
                <div class="card-header">
                    <h2>üåä Order Flow</h2>
                </div>
                <div class="order-flow-container">
                    <div class="flow-bar-container">
                        <span class="flow-label buy">BUY</span>
                        <div class="flow-bar">
                            <div class="flow-buy" id="flow-buy" style="width: 55%">55%</div>
                            <div class="flow-sell" id="flow-sell" style="width: 45%">45%</div>
                        </div>
                        <span class="flow-label sell">SELL</span>
                    </div>
                    <div class="imbalance-indicator">
                        <span class="imbalance-arrow bullish" id="imbalance-arrow">‚Üë</span>
                        <span class="imbalance-text" id="imbalance-text">Bullish Pressure (+10%)</span>
                    </div>
                </div>
            </div>

            <!-- System Metrics -->
            <div class="card system-metrics-card">
                <div class="card-header">
                    <h2>üíª System Health</h2>
                </div>
                <div class="system-metrics-grid">
                    <div class="system-metric">
                        <span class="system-metric-icon">üß†</span>
                        <span class="system-metric-value" id="cpu-usage">12%</span>
                        <span class="system-metric-label">CPU</span>
                    </div>
                    <div class="system-metric">
                        <span class="system-metric-icon">üì¶</span>
                        <span class="system-metric-value" id="memory-usage">45MB</span>
                        <span class="system-metric-label">Memory</span>
                    </div>
                    <div class="system-metric">
                        <span class="system-metric-icon">üîÑ</span>
                        <span class="system-metric-value" id="buffer-fill">23%</span>
                        <span class="system-metric-label">Buffer</span>
                    </div>
                </div>
                <div class="ring-buffer-viz" id="ring-buffer-viz">
                    <!-- Ring buffer visualization will be generated by JS -->
                </div>
            </div>

            <!-- Network Latency Breakdown -->
            <div class="card">
                <div class="card-header">
                    <h2>üåê Network Latency</h2>
                </div>
                <div class="risk-grid">
                    <div class="risk-metric">
                        <div class="risk-metric-header">
                            <span class="risk-metric-name">API ‚Üí Engine</span>
                        </div>
                        <span class="risk-metric-value positive" id="api-latency">0.8ms</span>
                    </div>
                    <div class="risk-metric">
                        <div class="risk-metric-header">
                            <span class="risk-metric-name">Engine Process</span>
                        </div>
                        <span class="risk-metric-value positive" id="process-latency">29ns</span>
                    </div>
                    <div class="risk-metric">
                        <div class="risk-metric-header">
                            <span class="risk-metric-name">Exchange RTT</span>
                        </div>
                        <span class="risk-metric-value neutral" id="exchange-rtt">45ms</span>
                    </div>
                    <div class="risk-metric">
                        <div class="risk-metric-header">
                            <span class="risk-metric-name">Total E2E</span>
                        </div>
                        <span class="risk-metric-value neutral" id="total-latency">46ms</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Crypto Trading Section -->
    <section class="crypto-section" id="crypto-section">
        <div class="crypto-header">
            <h2>‚Çø Crypto Trading Arena</h2>
            <span class="badge badge-crypto">Binance Live Feed</span>
        </div>

        <div class="crypto-content">
            <!-- Live Prices -->
            <div class="crypto-prices">
                <div class="crypto-price-card btc">
                    <div class="crypto-icon">‚Çø</div>
                    <div class="crypto-info">
                        <span class="crypto-name">Bitcoin</span>
                        <span class="crypto-symbol">BTC/USDT</span>
                    </div>
                    <div class="crypto-price-display">
                        <span class="crypto-price" id="btc-price">$--,---.--</span>
                        <span class="crypto-change positive" id="btc-change">+0.00%</span>
                    </div>
                </div>

                <div class="crypto-price-card eth">
                    <div class="crypto-icon">Œû</div>
                    <div class="crypto-info">
                        <span class="crypto-name">Ethereum</span>
                        <span class="crypto-symbol">ETH/USDT</span>
                    </div>
                    <div class="crypto-price-display">
                        <span class="crypto-price" id="eth-price">$-,---.--</span>
                        <span class="crypto-change positive" id="eth-change">+0.00%</span>
                    </div>
                </div>

                <div class="crypto-price-card sol">
                    <div class="crypto-icon">‚óé</div>
                    <div class="crypto-info">
                        <span class="crypto-name">Solana</span>
                        <span class="crypto-symbol">SOL/USDT</span>
                    </div>
                    <div class="crypto-price-display">
                        <span class="crypto-price" id="sol-price">$---.--</span>
                        <span class="crypto-change positive" id="sol-change">+0.00%</span>
                    </div>
                </div>
            </div>

            <!-- Crypto AI & Trades -->
            <div class="crypto-trading-grid">
                <div class="card crypto-ai-card">
                    <div class="card-header">
                        <h3>ü§ñ Crypto AI Signal</h3>
                        <div class="model-badge">
                            <img src="https://www.gstatic.com/lamda/images/gemini_sparkle_v002_d4735304ff6292a690345.svg"
                                alt="Gemini" class="model-icon">
                            <span>Gemini</span>
                        </div>
                    </div>
                    <div class="crypto-ai-reasoning" id="crypto-ai-reasoning">
                        <p>Waiting for Binance data stream...</p>
                    </div>
                    <div class="crypto-signals">
                        <div class="crypto-signal" id="btc-signal">
                            <span class="signal-asset">BTC</span>
                            <span class="signal-value neutral">HOLD</span>
                        </div>
                        <div class="crypto-signal" id="eth-signal">
                            <span class="signal-asset">ETH</span>
                            <span class="signal-value neutral">HOLD</span>
                        </div>
                        <div class="crypto-signal" id="sol-signal">
                            <span class="signal-asset">SOL</span>
                            <span class="signal-value neutral">HOLD</span>
                        </div>
                    </div>
                </div>

                <div class="card crypto-trades-card">
                    <div class="card-header">
                        <h3>üí± Crypto Trades</h3>
                        <span class="trades-badge" id="crypto-trades-count">0 trades</span>
                    </div>
                    <div class="crypto-trades-container" id="crypto-trades-container">
                        <div class="trade-placeholder">
                            <span>Start crypto_trader.py to begin trading</span>
                        </div>
                    </div>
                </div>


            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-left">
            <span class="mode-badge paper">üìù Paper Trading Mode</span>
            <span class="disclaimer">Simulated trading - No real money at risk</span>
        </div>
        <div class="footer-right">
            <span class="shortcuts-hint">
                Press <span class="key">?</span> for shortcuts
            </span>
            <span>Powered by <strong>Nanosecond Arbiter</strong> | Lock-Free SPSC Ring Buffer</span>
        </div>
    </footer>

    <script src="app.js"></script>
</body>

</html>